(function(a){'function'==typeof define&&define.amd?define('picker',['jquery'],a):'object'==typeof exports?module.exports=a(require('jquery')):this.Picker=a(jQuery)})(function(a){function b(o,p,q,r){function s(){return b._.node('div',b._.node('div',b._.node('div',b._.node('div',G.component.nodes(B.open),D.box),D.wrap),D.frame),D.holder,'tabindex="-1"')}function t(){E.data(p,G).addClass(D.input).val(E.data('value')?G.get('select',C.format):o.value),C.editable||E.on('focus.'+B.id+' click.'+B.id,function(H){H.preventDefault(),G.open()}).on('keydown.'+B.id,z),f(o,{haspopup:!0,expanded:!1,readonly:!1,owns:o.id+'_root'})}function u(){f(G.$root[0],'hidden',!0)}function v(){G.$holder.on({keydown:z,'focus.toOpen':y,blur:function(){E.removeClass(D.target)},focusin:function(H){G.$root.removeClass(D.focused),H.stopPropagation()},'mousedown click':function(H){var I=e(H,o);I!=G.$holder[0]&&(H.stopPropagation(),'mousedown'==H.type&&!a(I).is('input, select, textarea, button, option')&&(H.preventDefault(),G.$holder.eq(0).focus()))}}).on('click','[data-pick], [data-nav], [data-clear], [data-close]',function(){var H=a(this),I=H.data(),J=H.hasClass(D.navDisabled)||H.hasClass(D.disabled),K=j();K=K&&(K.type||K.href),(J||K&&!a.contains(G.$root[0],K))&&G.$holder.eq(0).focus(),!J&&I.nav?G.set('highlight',G.component.item.highlight,{nav:I.nav}):!J&&'pick'in I?(G.set('select',I.pick),C.closeOnSelect&&G.close(!0)):I.clear?(G.clear(),C.closeOnClear&&G.close(!0)):I.close&&G.close(!0)})}function w(){var H;!0===C.hiddenName?(H=o.name,o.name=''):(H=['string'==typeof C.hiddenPrefix?C.hiddenPrefix:'','string'==typeof C.hiddenSuffix?C.hiddenSuffix:'_submit'],H=H[0]+o.name+H[1]),G._hidden=a('<input type=hidden name="'+H+'"'+(E.data('value')||o.value?' value="'+G.get('select',C.formatSubmit)+'"':'')+'>')[0],E.on('change.'+B.id,function(){G._hidden.value=o.value?G.get('select',C.formatSubmit):''})}function x(){A&&n?G.$holder.find('.'+D.frame).one('transitionend',function(){G.$holder.eq(0).focus()}):setTimeout(function(){G.$holder.eq(0).focus()},0)}function y(H){H.stopPropagation(),E.addClass(D.target),G.$root.addClass(D.focused),G.open()}function z(H){var I=H.keyCode,J=/^(8|46)$/.test(I);return 27==I?(G.close(!0),!1):void((32==I||J||!B.open&&G.component.key[I])&&(H.preventDefault(),H.stopPropagation(),J?G.clear().close():G.open()))}if(!o)return b;var A=!1,B={id:o.id||'P'+Math.abs(~~(Math.random()*new Date))},C=q?a.extend(!0,{},q.defaults,r):r||{},D=a.extend({},b.klasses(),C.klass),E=a(o),F=function(){return this.start()},G=F.prototype={constructor:F,$node:E,start:function(){return B&&B.start?G:(B.methods={},B.start=!0,B.open=!1,B.type=o.type,o.autofocus=o==j(),o.readOnly=!C.editable,o.id=o.id||B.id,'text'!=o.type&&(o.type='text'),G.component=new q(G,C),G.$root=a('<div class="'+D.picker+'" id="'+o.id+'_root" />'),u(),G.$holder=a(s()).appendTo(G.$root),v(),C.formatSubmit&&w(),t(),C.containerHidden?a(C.containerHidden).append(G._hidden):E.after(G._hidden),C.container?a(C.container).append(G.$root):E.after(G.$root),G.on({start:G.component.onStart,render:G.component.onRender,stop:G.component.onStop,open:G.component.onOpen,close:G.component.onClose,set:G.component.onSet}).on({start:C.onStart,render:C.onRender,stop:C.onStop,open:C.onOpen,close:C.onClose,set:C.onSet}),A=c(G.$holder[0]),o.autofocus&&G.open(),G.trigger('start').trigger('render'))},render:function(H){return H?(G.$holder=a(s()),v(),G.$root.html(G.$holder)):G.$root.find('.'+D.box).html(G.component.nodes(B.open)),G.trigger('render')},stop:function(){return B.start?(G.close(),G._hidden&&G._hidden.parentNode.removeChild(G._hidden),G.$root.remove(),E.removeClass(D.input).removeData(p),setTimeout(function(){E.off('.'+B.id)},0),o.type=B.type,o.readOnly=!1,G.trigger('stop'),B.methods={},B.start=!1,G):G},open:function(H){return B.open?G:(E.addClass(D.active),f(o,'expanded',!0),setTimeout(function(){G.$root.addClass(D.opened),f(G.$root[0],'hidden',!1)},0),!1!==H&&(B.open=!0,A&&m.css('overflow','hidden').css('padding-right','+='+d()),x(),l.on('click.'+B.id+' focusin.'+B.id,function(I){var J=e(I,o);I.isSimulated||J==o||J==document||3==I.which||G.close(J===G.$holder[0])}).on('keydown.'+B.id,function(I){var J=I.keyCode,K=G.component.key[J],L=e(I,o);27==J?G.close(!0):L==G.$holder[0]&&(K||13==J)?(I.preventDefault(),K?b._.trigger(G.component.key.go,G,[b._.trigger(K)]):!G.$root.find('.'+D.highlighted).hasClass(D.disabled)&&(G.set('select',G.component.item.highlight),C.closeOnSelect&&G.close(!0))):a.contains(G.$root[0],L)&&13==J&&(I.preventDefault(),L.click())})),G.trigger('open'))},close:function(H){return(H&&(C.editable?o.focus():(G.$holder.off('focus.toOpen').focus(),setTimeout(function(){G.$holder.on('focus.toOpen',y)},0))),E.removeClass(D.active),f(o,'expanded',!1),setTimeout(function(){G.$root.removeClass(D.opened+' '+D.focused),f(G.$root[0],'hidden',!0)},0),!B.open)?G:(B.open=!1,A&&m.css('overflow','').css('padding-right','-='+d()),l.off('.'+B.id),G.trigger('close'))},clear:function(H){return G.set('clear',null,H)},set:function(H,I,J){var K,L,M=a.isPlainObject(H),N=M?H:{};if(J=M&&a.isPlainObject(I)?I:J||{},H){for(K in M||(N[H]=I),N)L=N[K],K in G.component.item&&(void 0==L&&(L=null),G.component.set(K,L,J)),('select'==K||'clear'==K)&&E.val('clear'==K?'':G.get(K,C.format)).trigger('change');G.render()}return J.muted?G:G.trigger('set',N)},get:function(H,I){if(H=H||'value',null!=B[H])return B[H];if('valueSubmit'==H){if(G._hidden)return G._hidden.value;H='value'}if('value'==H)return o.value;if(H in G.component.item){if('string'==typeof I){var J=G.component.get(H);return J?b._.trigger(G.component.formats.toString,G.component,[I,J]):''}return G.component.get(H)}},on:function(H,I,J){var K,L,M=a.isPlainObject(H),N=M?H:{};if(H)for(K in M||(N[H]=I),N)L=N[K],J&&(K='_'+K),B.methods[K]=B.methods[K]||[],B.methods[K].push(L);return G},off:function(){var H,I,J=arguments;for(H=0,namesCount=J.length;H<namesCount;H+=1)I=J[H],I in B.methods&&delete B.methods[I];return G},trigger:function(H,I){var J=function(K){var L=B.methods[K];L&&L.map(function(M){b._.trigger(M,G,[I])})};return J('_'+H),J(H),G}};return new F}function c(o){var p,q='position';return o.currentStyle?p=o.currentStyle[q]:window.getComputedStyle&&(p=getComputedStyle(o)[q]),'fixed'==p}function d(){if(m.height()<=k.height())return 0;var o=a('<div style="visibility:hidden;width:100px" />').appendTo('body'),p=o[0].offsetWidth;o.css('overflow','scroll');var q=a('<div style="width:100%" />').appendTo(o),r=q[0].offsetWidth;return o.remove(),p-r}function e(o,p){var q=[];return o.path&&(q=o.path),o.originalEvent&&o.originalEvent.path&&(q=o.originalEvent.path),q&&0<q.length?p&&0<=q.indexOf(p)?p:q[0]:o.target}function f(o,p,q){if(a.isPlainObject(p))for(var r in p)g(o,r,p[r]);else g(o,p,q)}function g(o,p,q){o.setAttribute(('role'==p?'':'aria-')+p,q)}function j(){try{return document.activeElement}catch(o){}}var k=a(window),l=a(document),m=a(document.documentElement),n=null!=document.documentElement.style.transition;return b.klasses=function(o){return o=o||'picker',{picker:o,opened:o+'--opened',focused:o+'--focused',input:o+'__input',active:o+'__input--active',target:o+'__input--target',holder:o+'__holder',frame:o+'__frame',wrap:o+'__wrap',box:o+'__box'}},b._={group:function(o){for(var p,q='',r=b._.trigger(o.min,o);r<=b._.trigger(o.max,o,[r]);r+=o.i)p=b._.trigger(o.item,o,[r]),q+=b._.node(o.node,p[0],p[1],p[2]);return q},node:function(o,p,q,r){return p?(p=a.isArray(p)?p.join(''):p,q=q?' class="'+q+'"':'',r=r?' '+r:'','<'+o+q+r+'>'+p+'</'+o+'>'):''},lead:function(o){return(10>o?'0':'')+o},trigger:function(o,p,q){return'function'==typeof o?o.apply(p,q||[]):o},digits:function(o){return /\d/.test(o[1])?2:1},isDate:function(o){return-1<{}.toString.call(o).indexOf('Date')&&this.isInteger(o.getDate())},isInteger:function(o){return-1<{}.toString.call(o).indexOf('Number')&&0==o%1},ariaAttr:function(o,p){for(var q in a.isPlainObject(o)||(o={attribute:p}),p='',o){var r=('role'==q?'':'aria-')+q,s=o[q];p+=null==s?'':r+'="'+o[q]+'"'}return p}},b.extend=function(o,p){a.fn[o]=function(q,r){var s=this.data(o);return'picker'==q?s:s&&'string'==typeof q?b._.trigger(s[q],s,[r]):this.each(function(){var t=a(this);t.data(o)||new b(this,o,p,q)})},a.fn[o].defaults=p.defaults},b});